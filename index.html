<html>

<head>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        #game {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr 1fr;
            /* background-color: #773d94;
            border-radius: 5px; */
        }
        
        .cell {
            background-color: white;
            /* margin: 10px; */
            /* border: 0px; */
            height: 50px;
            width: 50px;
            border: 1px dashed #d1cece;
            /* color: white; */
            /* border-radius: 10px; */
            font-size: 40px;
        }
        
        .cell-left {
            border-left-style: solid;
            border-left-color: black;
        }
        
        .cell-right {
            border-right-style: solid;
            border-right-color: black;
        }
        
        .cell-top {
            border-top-style: solid;
            border-top-color: black;
        }
        
        .cell-bottom {
            border-bottom-style: solid;
            border-bottom-color: black;
        }
        
        .border-left {
            border-left-width: 2px;
        }
        
        .border-right {
            border-right-width: 2px;
        }
        
        .border-top {
            border-top-width: 2px;
        }
        
        .border-bottom {
            border-bottom-width: 2px;
        }
        
        .selected {
            background-color: #88bbfb;
        }
        
        .error {
            color: red;
        }
        
        #counts {
            display: flex;
        }
        
        .item {
            background-color: white;
            border: 1px solid;
            border-radius: 5px;
            font-size: 50px;
            height: 100px;
            width: 75px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            margin-right: 5px;
            margin-top: 5px;
        }
        
        .contador {
            font-size: 25px;
        }
        
        .btnAcao {
            background-color: white;
            border: 1px solid;
            border-radius: 5px;
            font-size: 25px;
            height: 50px;
            width: 250px;
            margin-right: 5px;
            margin-top: 5px;
        }
        
        .marcacao {
            font-size: 10px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
        }
    </style>
</head>

<body>
    <h1>Sudoku</h1>
    <div id="game"></div>
    <div style="display: flex;">
        <button class="btnAcao" onclick="apagar()">Apagar</button>
        <button class="btnAcao" onclick="switchMarcacao()">Mostrar marcações</button>
    </div>
    <div id="counts"></div>

    <script>
        const game = document.querySelector('#game');
        const counts = document.querySelector('#counts');
        let mostrarMarcacoes = false;
        const tabuleiro = [];
        const contadores = [];
        const cellSelected = {
            i: 0,
            j: 0,
            value: 0
        }

        function iniciaJogo() {
            for (let i = 0; i < 9; i++) {
                const linha = [];
                for (let j = 0; j < 9; j++)
                    linha.push(0);
                tabuleiro.push(linha);
            }

            for (let i = 0; i < 9; i++)
                contadores.push(9)
        }

        function clickCell(i, j) {
            cellSelected.i = i;
            cellSelected.j = j;
            cellSelected.value = tabuleiro[cellSelected.i][cellSelected.j];
            desenhaJogo();
        }

        function verficaDuplicidadeDeValorNaLinha(linha, coluna, valor) {
            const indexLinha = tabuleiro[linha].findIndex((cell, index) => cell == valor && coluna != index);
            if (indexLinha > -1)
                return true;
            return false
        }

        function verificaDuplicidadeDeValorNaColuna(linha, coluna, valor) {
            for (let i = 0; i < 9; i++)
                if (tabuleiro[i][coluna] == valor && i != linha)
                    return true;
            return false;
        }

        function verificaDuplicidadeDeValorNoQuadrante(linha, coluna, valor) {
            const iQuadrante = (Math.floor(linha / 3) * 3);
            const jQuadrante = (Math.floor(coluna / 3) * 3);

            for (let i = iQuadrante; i < iQuadrante + 3; i++) {
                for (let j = jQuadrante; j < jQuadrante + 3; j++) {
                    if (tabuleiro[i][j] == valor && i != linha)
                        return true;
                }
            }
            return false;
        }

        function erroNaLogicaDoJogo(linha, coluna) {
            const valor = tabuleiro[linha][coluna]
            if (valor > 0) {
                return verficaDuplicidadeDeValorNaLinha(linha, coluna, valor) ||
                    verificaDuplicidadeDeValorNaColuna(linha, coluna, valor) ||
                    verificaDuplicidadeDeValorNoQuadrante(linha, coluna, valor);
            }
            return false;
        }

        function definePossibilidades(linha, coluna) {
            const opcoes = []
            for (var valor = 1; valor <= 9; valor++) {
                if (verficaDuplicidadeDeValorNaLinha(linha, coluna, valor) ||
                    verificaDuplicidadeDeValorNaColuna(linha, coluna, valor) ||
                    verificaDuplicidadeDeValorNoQuadrante(linha, coluna, valor))
                    continue;

                //passou...
                opcoes.push(valor);
            }

            let ret = '';
            for (var i = 1; i <= 9; i++)
                if (opcoes.findIndex(x => x == i) > -1)
                    ret += `<div>${i}</div>`;
                else
                    ret += `<div> </div>`;

            return ret;
        }

        function desenhaTabuleiro() {
            game.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                for (let j = 0; j < 9; j++) {
                    let classe = 'cell ';
                    if (i == cellSelected.i && j == cellSelected.j || cellSelected.value > 0 && tabuleiro[i][j] == cellSelected.value)
                        classe += ' selected '

                    if (i == 0)
                        classe += 'border-top '
                    if (i == 8)
                        classe += 'border-bottom '
                    if (j == 8)
                        classe += 'border-right '
                    if (j == 0)
                        classe += 'border-left '

                    if (i == 0 || i % 3 == 0)
                        classe += 'cell-top '
                    if (i == 8 || (i + 1) % 3 == 0)
                        classe += 'cell-bottom '
                    if (j == 8 || (j + 1) % 3 == 0)
                        classe += 'cell-right '
                    if (j == 0 || j % 3 == 0)
                        classe += 'cell-left '

                    if (erroNaLogicaDoJogo(i, j))
                        classe += 'error '

                    let innerHTML = tabuleiro[i][j] > 0 ? tabuleiro[i][j] : '';
                    if (innerHTML == '' && mostrarMarcacoes) {
                        classe += 'marcacao '
                        innerHTML = definePossibilidades(i, j);
                    }

                    game.innerHTML += `<button class="${classe}" onclick="clickCell(${i}, ${j})">${innerHTML}</button>`
                }
            }
        }

        function clickCount(numero) {
            if (contadores[numero - 1] > 0) {
                if (tabuleiro[cellSelected.i][cellSelected.j] > 0)
                    contadores[tabuleiro[cellSelected.i][cellSelected.j] - 1]++;
                tabuleiro[cellSelected.i][cellSelected.j] = numero;
                cellSelected.value = numero;
                contadores[numero - 1]--;
                desenhaJogo();
            }
        }

        function apagar() {
            const numero = tabuleiro[cellSelected.i][cellSelected.j];
            contadores[numero - 1]++;
            tabuleiro[cellSelected.i][cellSelected.j] = 0;
            cellSelected.value = 0;
            desenhaJogo();
        }

        function switchMarcacao() {
            mostrarMarcacoes = !mostrarMarcacoes;
            desenhaJogo();
        }

        function desenhaContadores() {
            counts.innerHTML = '';
            for (let i = 0; i < 9; i++) {
                counts.innerHTML += `<button class="item" onclick="clickCount(${i + 1})">${i + 1}<div class="contador">${contadores[i]}</div></button>`
            }
        }

        function desenhaJogo() {
            desenhaTabuleiro();
            desenhaContadores();
        }

        iniciaJogo()
        desenhaJogo();
    </script>
</body>

</html>